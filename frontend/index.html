<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Local HF Chatbot</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="page">
      <header class="header">
        <div class="logo">üß†</div>

        <!-- Azioni header: impostazioni, offload, modello, token, pulisci -->
        <div class="header-actions compute-and-actions">
          <!-- Wrapper impostazioni -->
          <div class="settings-wrapper">
            <button
              id="settings-btn"
              class="icon-btn"
              title="Impostazioni modello"
            >
              ‚öôÔ∏è
            </button>

            <!-- Pannello impostazioni modello -->
            <div id="settings-panel" class="settings-panel">
              <div class="settings-header">
                <span>Model settings</span>
                <button
                  id="settings-close"
                  class="icon-btn small"
                  title="Chiudi impostazioni"
                >
                  ‚úï
                </button>
              </div>

              <!-- Sezione compute mode -->
              <div class="settings-section">
                <label class="settings-label">Compute mode</label>
                <div class="compute-toggle">
                  <button
                    id="btn-cpu"
                    class="compute-btn compute-btn-cpu"
                    type="button"
                  >
                    CPU
                  </button>
                  <button
                    id="btn-gpu"
                    class="compute-btn compute-btn-gpu"
                    type="button"
                  >
                    GPU
                  </button>
                </div>
                <p class="settings-hint">
                  Scegli se eseguire il modello su CPU o GPU (quando disponibile).
                </p>
              </div>

              <!-- Sezione temperatura -->
              <div class="settings-section">
                <label for="temperature-slider" class="settings-label">
                  Temperature
                  <span id="temperature-value" class="settings-value">0.15</span>
                </label>
                <input
                  id="temperature-slider"
                  type="range"
                  min="0.01"
                  max="1"
                  step="0.01"
                  value="0.15"
                />
                <p class="settings-hint">
                  Valori pi√π bassi =&gt; risposte pi√π deterministiche, pi√π alti =&gt;
                  pi√π creative. Default: 0.3 (GPT-2 friendly).
                </p>
              </div>

              <!-- Sezione avanzata: altri parametri -->
              <div class="settings-section">
                <div class="settings-grid">
                  <div class="settings-field">
                    <label for="max-tokens-input" class="settings-label">
                      Max tokens
                    </label>
                    <input
                      id="max-tokens-input"
                      type="number"
                      min="1"
                      max="2048"
                      value="10"
                    />
                    <p class="settings-hint small">
                      Numero massimo di token generati.
                    </p>
                  </div>

                  <div class="settings-field">
                    <label for="top-p-input" class="settings-label">
                      top_p
                    </label>
                    <input
                      id="top-p-input"
                      type="number"
                      step="0.01"
                      min="0"
                      max="1"
                      value="0.95"
                    />
                    <p class="settings-hint small">
                      Nucleus sampling (default 0.95).
                    </p>
                  </div>

                  <div class="settings-field">
                    <label for="top-k-input" class="settings-label">
                      top_k
                    </label>
                    <input
                      id="top-k-input"
                      type="number"
                      min="0"
                      max="200"
                      value="40"
                    />
                    <p class="settings-hint small">
                      Limita il vocabolario ai k token pi√π probabili.
                    </p>
                  </div>

                  <div class="settings-field">
                    <label for="repetition-penalty-input" class="settings-label">
                      Repetition penalty
                    </label>
                    <input
                      id="repetition-penalty-input"
                      type="number"
                      step="0.01"
                      min="0.5"
                      max="2"
                      value="1.15"
                    />
                    <p class="settings-hint small">
                      >1 riduce le ripetizioni (default 1.15).
                    </p>
                  </div>
                </div>

                <p class="settings-hint">
                  I valori di default sono ottimizzati per modelli pre-trained
                  in stile GPT-2 / GPT-J.
                </p>
              </div>
            </div>
          </div>

          <!-- Spia OFFLOAD -->
          <div class="offload-indicator" title="Offload su disco">
            <span id="offload-dot" class="offload-dot"></span>
            <span class="offload-label">OL</span>
          </div>

          <!-- Selettore modello + input repo -->
          <div id="div-model-select" class="model-select">
            <label for="model-list">Modello:</label>
            <select id="model-list"></select>
            <input
              id="model-id-input"
              type="text"
              placeholder="repo_id HuggingFace"
            />
            <button id="download-btn">Scarica</button>
          </div>

          <!-- Bottone per gestire il token HF -->
          <button
            id="hf-token-btn"
            class="icon-btn"
            title="Imposta Hugging Face token"
          >
            üîë
          </button>

          <!-- Bottone per pulire la chat -->
          <button
            id="clear-chat-btn"
            class="icon-btn clear-chat-btn"
            title="Pulisci la chat e ricarica la pagina"
          >
            üóëÔ∏è <span class="clear-chat-label">Pulisci</span>
          </button>

          <!-- Pannellino per inserire il token HF -->
          <div id="hf-token-panel" class="hf-token-panel">
            <div class="hf-token-header">
              <span>Hugging Face Token</span>
              <button
                id="hf-token-close"
                class="icon-btn small"
                title="Chiudi"
              >
                ‚úï
              </button>
            </div>
            <input
              id="hf-token-input"
              type="password"
              placeholder="hf_xxxxxxxxxxxxxxxxx"
            />
            <div class="hf-token-actions">
              <button id="hf-token-save" class="primary-btn">Salva</button>
              <button id="hf-token-clear" class="secondary-btn">
                Rimuovi
              </button>
            </div>
            <p class="hf-token-hint">
              Il token viene salvato solo nel tuo browser (localStorage).
            </p>
          </div>
        </div>
      </header>

      <main class="main">
        <section class="chat-container" id="chat-container">
          <!-- messaggi della chat -->
        </section>
      </main>

      <footer class="footer">
        <div class="input-wrapper">
          <textarea
            id="user-input"
            rows="1"
            placeholder="Scrivi un messaggio..."
          ></textarea>
          <button id="send-btn">‚û§</button>
        </div>
      </footer>
    </div>

    <script type="module" src="main.js"></script>
  </body>
</html>
